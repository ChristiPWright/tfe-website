<?xml version="1.0" encoding="UTF-8"?>

<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">

   

    <service verb="get" noun="CategoryProducts">
        <in-parameters>
           <parameter name="productCategoryId" required="true"/>
        </in-parameters>
        
        <out-parameters>
           <parameter name="productList" type="List">
           <parameter name="productInfo" type="Map">
        </out-parameters>
        
        <actions>
            <service-call>
            <entity-find entity-name="mantle.product.category.ProductCategoryMember" list="productList" cache="true">
                <econdition field-name="productCategoryId" value="PAINTING"/>
            </entity-find>
            <set field="pcmList" from="productList"/>
            <set field="prodList" from="productList.productId" />

            <iterate list="prodList" entry="eachProd">
                <entity-find-one entity-name="mantle.product.ProductPrice" value-field="productPrice" cache="true">
                    <field-map field-name="productPriceId" from="prodList.productPriceId"/>

                </entity-find-one>
                <set field="prices" = from="productPrice.price" />
            </iterate>


        <log message="pcmList-----------------------${pcmList} -------------------" />
        </actions>     
    </service>    
</services>